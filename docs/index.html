<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bayesian Methods for Image Segmentation using a Potts Model • bayesImageS</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="jquery.sticky-kit.min.js"></script><script src="pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">bayesImageS</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="articles/mcmcPotts.html">bayesImageS::mcmcPotts</a>
    </li>
  </ul>
</li>
<li>
  <a href="news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    

    
    
<div class="contents">
<div id="bayesimages" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#bayesimages" class="anchor"></a>bayesImageS</h1></div>
<!--- README.md is generated from README.Rmd. Please edit that file -->

<p><code>bayesImageS</code> implements algorithms for segmentation of 2D and 3D images, such as computed tomography (CT) and satellite remote sensing. This R package provides functions for Bayesian image analysis using a hidden Potts/Ising model with external field prior. Latent labels are updated using chequerboard Gibbs sampling or Swendsen-Wang. Algorithms for the smoothing parameter include:</p>
<ul>
<li>pseudolikelihood</li>
<li>path sampling (thermodynamic integration)</li>
<li>approximate exchange algorithm (AEA)</li>
<li>approximate Bayesian computation (ABC-MCMC and ABC-SMC)</li>
<li>Bayesian indirect likelihood (BIL)</li>
</ul>
</div>
<div id="installation-instructions" class="section level1">
<h1 class="hasAnchor">
<a href="#installation-instructions" class="anchor"></a>Installation Instructions</h1>
<p>Stable releases, including binary packages for Windows &amp; Mac OS, are available from CRAN:</p>
<ul>
<li><a href="https://CRAN.R-project.org/package=bayesImageS" class="uri">https://CRAN.R-project.org/package=bayesImageS</a></li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">install.packages</span>(<span class="st">"bayesImageS"</span>)</code></pre></div>
<p>The current development version can be installed from Bitbucket:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">devtools<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/devtools/topics/install_git">install_git</a></span>(<span class="st">"https://bitbucket.org/Azeari/bayesimages/"</span>)</code></pre></div>
</div>
<div id="example-usage" class="section level1">
<h1 class="hasAnchor">
<a href="#example-usage" class="anchor"></a>Example Usage</h1>
<p>To generate synthetic data for a known value of <span class="math inline">\(\beta\)</span>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">1234</span>)
<span class="kw">library</span>(bayesImageS)
mask &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">3</span>)
neigh &lt;-<span class="st"> </span><span class="kw"><a href="reference/getNeighbors.html">getNeighbors</a></span>(mask, <span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">0</span>,<span class="dv">0</span>))
blocks &lt;-<span class="st"> </span><span class="kw"><a href="reference/getBlocks.html">getBlocks</a></span>(mask, <span class="dv">2</span>)
k &lt;-<span class="st"> </span><span class="dv">3</span>
beta &lt;-<span class="st"> </span><span class="fl">0.7</span>
res.sw &lt;-<span class="st"> </span><span class="kw"><a href="reference/swNoData.html">swNoData</a></span>(beta, k, neigh, blocks, <span class="dt">niter=</span><span class="dv">200</span>)
z &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">max.col</span>(res.sw<span class="op">$</span>z)[<span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(neigh)], <span class="dt">nrow=</span><span class="kw">nrow</span>(mask))
<span class="kw">image</span>(z, <span class="dt">xaxt =</span> <span class="st">'n'</span>, <span class="dt">yaxt=</span><span class="st">'n'</span>, <span class="dt">col=</span><span class="kw">rainbow</span>(k), <span class="dt">asp=</span><span class="dv">1</span>)</code></pre></div>
<p><img src="inst/image/README-unnamed-chunk-4-1.png" width="672"></p>
<p>Now add some Gaussian noise to the labels, according to the prior:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">priors &lt;-<span class="st"> </span><span class="kw">list</span>()
priors<span class="op">$</span>k &lt;-<span class="st"> </span>k
priors<span class="op">$</span>mu &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="op">-</span><span class="dv">2</span>, <span class="dv">0</span>, <span class="dv">2</span>)
priors<span class="op">$</span>mu.sd &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="fl">0.5</span>,k)
priors<span class="op">$</span>sigma &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="fl">0.25</span>,k)
priors<span class="op">$</span>sigma.nu &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dv">3</span>, k)
priors<span class="op">$</span>beta &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>,<span class="fl">1.3</span><span class="op">*</span><span class="kw">log</span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="kw">sqrt</span>(k)))

m0 &lt;-<span class="st"> </span><span class="kw">sort</span>(<span class="kw">rnorm</span>(priors<span class="op">$</span>k,priors<span class="op">$</span>mu,priors<span class="op">$</span>mu.sd))
SS0 &lt;-<span class="st"> </span>priors<span class="op">$</span>sigma.nu<span class="op">*</span>priors<span class="op">$</span>sigma<span class="op">^</span><span class="dv">2</span>
s0 &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">/</span><span class="kw">sqrt</span>(<span class="kw">rgamma</span>(priors<span class="op">$</span>k,priors<span class="op">$</span>sigma.nu<span class="op">/</span><span class="dv">2</span>,SS0<span class="op">/</span><span class="dv">2</span>))
l &lt;-<span class="st"> </span><span class="kw">as.vector</span>(z)
y &lt;-<span class="st"> </span>m0[l] <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(<span class="kw">nrow</span>(neigh),<span class="dv">0</span>,s0[l])
<span class="kw">library</span>(lattice)
<span class="kw"><a href="http://www.rdocumentation.org/packages/lattice/topics/levelplot">levelplot</a></span>(<span class="kw">matrix</span>(y, <span class="dt">nrow=</span><span class="kw">nrow</span>(mask)))</code></pre></div>
<p><img src="inst/image/README-unnamed-chunk-5-1.png" width="672"></p>
<p>Image segmentation using ABC-SMC:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">res.smc &lt;-<span class="st"> </span><span class="kw"><a href="reference/smcPotts.html">smcPotts</a></span>(y, neigh, blocks, <span class="dt">priors=</span>priors)
<span class="co">#&gt; Initialization took 7sec</span>
<span class="co">#&gt; Iteration 1</span>
<span class="co">#&gt; previous epsilon 7 and ESS 10000 (target: 9500)</span>
<span class="co">#&gt; Took 0sec to update epsilon=2.625 (ESS=9505.29)</span>
<span class="co">#&gt; Took 7sec for 8918 RWMH updates (bw=0.497509)</span>
<span class="co">#&gt; Took 1sec for 10000 iterations to calculate S(z)=7</span>
<span class="co">#&gt; Iteration 2</span>
<span class="co">#&gt; previous epsilon 2.625 and ESS 9505.29 (target: 9030.02)</span>
<span class="co">#&gt; Took 9sec to update epsilon=1 (ESS=7970.86)</span>
<span class="co">#&gt; Took 7sec for 7671 RWMH updates (bw=0.466951)</span>
<span class="co">#&gt; Took 0sec for 10000 iterations to calculate S(z)=6</span>
<span class="co">#&gt; Iteration 3</span>
<span class="co">#&gt; previous epsilon 1 and ESS 7970.86 (target: 7572.32)</span>
<span class="co">#&gt; Took 10sec to update epsilon=4.66632e-302 (ESS=7949.67)</span>
<span class="co">#&gt; Took 6sec for 7968 RWMH updates (bw=0.466673)</span>
<span class="co">#&gt; Took 1sec for 10000 iterations to calculate S(z)=7</span>
<span class="co"># pixel classifications</span>
pred &lt;-<span class="st"> </span>res.smc<span class="op">$</span>alloc<span class="op">/</span><span class="kw">rowSums</span>(res.smc<span class="op">$</span>alloc)
predMx &lt;-<span class="st"> </span><span class="kw">as.raster</span>(<span class="kw">array</span>(pred, <span class="dt">dim=</span><span class="kw">c</span>(<span class="kw">nrow</span>(mask),<span class="kw">ncol</span>(mask),<span class="dv">3</span>)))
<span class="kw">plot</span>(<span class="kw">c</span>(<span class="fl">0.5</span>,<span class="fl">3.5</span>),<span class="kw">c</span>(<span class="fl">0.5</span>,<span class="fl">3.5</span>),<span class="dt">type=</span><span class="st">'n'</span>,<span class="dt">xaxt=</span><span class="st">'n'</span>,<span class="dt">yaxt=</span><span class="st">'n'</span>,<span class="dt">xlab=</span><span class="st">""</span>,<span class="dt">ylab=</span><span class="st">""</span>,<span class="dt">asp=</span><span class="dv">1</span>)
<span class="kw">rasterImage</span>(<span class="kw">t</span>(predMx)[<span class="kw">nrow</span>(mask)<span class="op">:</span><span class="dv">1</span>,], <span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">3.5</span>, <span class="fl">3.5</span>, <span class="dt">interpolate =</span> <span class="ot">FALSE</span>)</code></pre></div>
<p><img src="inst/image/README-unnamed-chunk-6-1.png" width="672"></p>
<p>Note that CODA ignores the particle weights, so we need to resample to obtain accurate HPD intervals. This step is not usually necessary and does introduce some noise due to duplication of particles. Depending on how many SMC iterations have been performed, one or more resampling steps might have already been done (but not in this specific example).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">seg &lt;-<span class="st"> </span><span class="kw">max.col</span>(res.smc<span class="op">$</span>alloc) <span class="co"># posterior mode (0-1 loss)</span>
<span class="kw">all.equal</span>(seg, l)
<span class="co">#&gt; [1] TRUE</span>

<span class="co"># filter weights to remove Ninf, NaN</span>
w &lt;-<span class="st"> </span>res.smc<span class="op">$</span>wt
w[<span class="kw">is.na</span>(w)] &lt;-<span class="st"> </span><span class="dv">0</span>
<span class="kw">plot</span>(<span class="kw">density</span>(res.smc<span class="op">$</span>beta, <span class="dt">weights=</span>w),<span class="dt">main=</span><span class="kw">expression</span>(<span class="kw">paste</span>(<span class="st">"Posterior for "</span>,beta)))
<span class="kw">abline</span>(<span class="dt">h=</span><span class="dv">0</span>,<span class="dt">lty=</span><span class="dv">3</span>)
<span class="kw">abline</span>(<span class="dt">v=</span>beta,<span class="dt">lty=</span><span class="dv">2</span>,<span class="dt">col=</span><span class="dv">4</span>)
<span class="kw">abline</span>(<span class="dt">v=</span><span class="kw">log</span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="kw">sqrt</span>(k)),<span class="dt">lty=</span><span class="dv">3</span>,<span class="dt">col=</span><span class="dv">2</span>) <span class="co"># critical point</span></code></pre></div>
<p><img src="inst/image/README-unnamed-chunk-7-1.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
<span class="kw">library</span>(coda)
res.res &lt;-<span class="st"> </span><span class="kw"><a href="reference/testResample.html">testResample</a></span>(res.smc<span class="op">$</span>beta, w, <span class="kw">cbind</span>(res.smc<span class="op">$</span>mu, res.smc<span class="op">$</span>sigma))
<span class="co">#&gt; Took 0sec to resample 10000 particles</span>
res.coda &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/coda/topics/mcmc">mcmc</a></span>(<span class="kw">cbind</span>(res.res<span class="op">$</span>pseudo, res.res<span class="op">$</span>beta))
<span class="kw"><a href="http://www.rdocumentation.org/packages/coda/topics/varnames">varnames</a></span>(res.coda) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">paste</span>(<span class="st">"mu"</span>,<span class="dv">1</span><span class="op">:</span>k), <span class="kw">paste</span>(<span class="st">"sd"</span>,<span class="dv">1</span><span class="op">:</span>k), <span class="st">"beta"</span>)
<span class="kw"><a href="http://www.rdocumentation.org/packages/coda/topics/HPDinterval">HPDinterval</a></span>(res.coda)
<span class="co">#&gt;            lower      upper</span>
<span class="co">#&gt; mu 1 -2.56248597 -1.9038983</span>
<span class="co">#&gt; mu 2 -0.50953511  0.4881316</span>
<span class="co">#&gt; mu 3  1.37933533  2.7939284</span>
<span class="co">#&gt; sd 1  0.11321785  0.4984628</span>
<span class="co">#&gt; sd 2  0.22470066  0.9154286</span>
<span class="co">#&gt; sd 3  0.11011734  0.9105506</span>
<span class="co">#&gt; beta  0.09338037  1.2852256</span>
<span class="co">#&gt; attr(,"Probability")</span>
<span class="co">#&gt; [1] 0.95</span>
m0
<span class="co">#&gt; [1] -2.279614  0.156580  2.208122</span>
s0
<span class="co">#&gt; [1] 0.2785175 0.6092555 0.3153176</span>
beta
<span class="co">#&gt; [1] 0.7</span></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2 class="hasAnchor">
<a href="#sidebar" class="anchor"></a>Links</h2>
<ul class="list-unstyled">
<li>Download from CRAN at <br><a href="https://cran.r-project.org/package=bayesImageS">https://​cran.r-project.org/​package=bayesImageS</a>
</li>
<li>Report a bug at <br><a href="https://bitbucket.org/Azeari/bayesimages/issues">https://​bitbucket.org/​Azeari/​bayesimages/​issues</a>
</li>
</ul>
<h2>License</h2>
<p>GPL (&gt;= 2)</p>
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Matt Moores <br><small class="roles"> Author, maintainer </small> <br><small>(0000-0003-4531-3572)</small>
</li>
<li>Kerrie Mengersen <br><small class="roles"> Author, thesis advisor </small> <br><small>(0000-0001-8625-9168)</small>
</li>
<li><a href="authors.html">All authors...</a></li>
</ul>
<h2>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://cran.r-project.org/package=bayesImageS"><img src="http://www.r-pkg.org/badges/version/bayesImageS" alt="cran version"></a></li>
<li><a href="https://github.com/metacran/cranlogs.app"><img src="http://cranlogs.r-pkg.org/badges/grand-total/bayesImageS" alt="rstudio mirror downloads"></a></li>
<li><a href="http://www.rpackages.io/package/bayesImageS"><img src="http://www.rpackages.io/badge/bayesImageS.svg" alt="rpackages.io rank"></a></li>
</ul>
</div>

</div>


      <footer><div class="copyright">
  <p>Developed by Matt Moores, Kerrie Mengersen.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
